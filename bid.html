<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘è¦å‡ºåƒ¹ - ç¾å ´ç«¶æ¨™ç³»çµ±</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f0f2f5; padding: 15px; text-align: center; transition: 0.3s; }
        .card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
        .info-bar { background: #fff3e0; color: #e67e22; padding: 10px; border-radius: 10px; font-weight: bold; margin-bottom: 15px; font-size: 14px; }
        
        input { width: 100%; padding: 15px; font-size: 18px; border: 2px solid #ddd; border-radius: 12px; box-sizing: border-box; margin-bottom: 20px; text-align: center; outline: none; }
        input:focus { border-color: #3498db; }

        /* å–Šåƒ¹æŒ‰éˆ• (è—è‰²å¤§æŒ‰éˆ•) */
        .b-call { width: 100%; padding: 25px; font-size: 26px; background: #3498db; color: white; border: none; border-radius: 15px; cursor: pointer; font-weight: bold; margin-bottom: 15px; box-shadow: 0 6px #2980b9; transition: 0.1s; }
        .b-call:active { box-shadow: 0 2px #2980b9; transform: translateY(4px); }

        /* å¿«é€ŸåŠ ç¢¼ç¶²æ ¼ */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        button.b-add { padding: 18px; font-size: 20px; border: none; border-radius: 12px; color: white; cursor: pointer; background: #27ae60; font-weight: bold; box-shadow: 0 4px #219150; }
        button.b-add:active { box-shadow: 0 2px #219150; transform: translateY(2px); }
        
        /* æ£„æ¨™æŒ‰éˆ• */
        .b-quit { background: #95a5a6; grid-column: span 2; margin-top: 15px; padding: 12px; color: white; border: none; border-radius: 10px; font-size: 14px; }
        
        #msg { margin-top: 15px; font-weight: bold; min-height: 24px; font-size: 18px; }
        
        /* çµæ¨™æ¨£å¼ */
        .closed-body { background: #2c3e50; }
        .closed-card { background: #ecf0f1; border: 5px solid #f1c40f; }
    </style>
</head>
<body>

<div class="card" id="mainCard">
    <div id="info" class="info-bar">æ­£åœ¨é€£æ¥è‡³ç«¶æ¨™ç³»çµ±...</div>
    
    <input type="text" id="userName" placeholder="ğŸ‘¤ è«‹è¼¸å…¥æ‚¨çš„å§“å">
    
    <div id="actions">
        <button class="b-call" onclick="bid(1)">å–Šåƒ¹ (+1)</button>
        <div class="grid">
            <button class="b-add" onclick="bid(5)">+$5</button>
            <button class="b-add" onclick="bid(10)">+$10</button>
            <button class="b-add" onclick="bid(50)">+$50</button>
            <button class="b-add" onclick="bid(100)">+$100</button>
            <button class="b-quit" onclick="quitBid()">âŒ æˆ‘è¦æ£„æ¨™ / é‡è¨­</button>
        </div>
    </div>
    <div id="msg"></div>
</div>

<script>
    // Firebase é…ç½® (èˆ‡å¤§è¢å¹•ç«¯ä¸€è‡´)
    const firebaseConfig = {
        apiKey: "AIzaSyBLKKHyGT1MHJqMq8q8tjJTBNTaIc7EKBs",
        authDomain: "money0115.firebaseapp.com",
        databaseURL: "https://money0115-default-rtdb.firebaseio.com",
        projectId: "money0115",
        storageBucket: "money0115.firebasestorage.app",
        messagingSenderId: "486161681478",
        appId: "1:486161681478:web:ea1107c2c5c8ebe6a5ce47",
        measurementId: "G-WT1BGS47KH"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref('auction_live');

    let currentStartPrice = 0;
    let bidsList = {};

    // ç›£è½å¾Œå°æ•¸æ“š
    db.on('value', (snapshot) => {
        const data = snapshot.val() || {};
        currentStartPrice = data.startPrice || 0;
        bidsList = data.bids || {};
        const status = data.status || 'open';
        const hasAnyBid = Object.keys(bidsList).length > 0;

        // æ›´æ–°ç‹€æ…‹é¡¯ç¤º
        const infoDiv = document.getElementById('info');
        if (status === 'closed') {
            document.body.classList.add('closed-body');
            document.getElementById('mainCard').classList.add('closed-card');
            document.getElementById('actions').style.display = 'none';
            document.getElementById('msg').innerText = "ğŸ”¨ ç«¶æ¨™å·²çµæŸï¼è«‹æŸ¥çœ‹å¤§è¢å¹•";
            document.getElementById('msg').style.color = "#c0392b";
            infoDiv.innerText = "æœ¬è¼ªç«¶æ¨™çµæŸ";
            infoDiv.style.background = "#bdc3c7";
            infoDiv.style.color = "#2c3e50";
        } else {
            document.body.classList.remove('closed-body');
            document.getElementById('mainCard').classList.remove('closed-card');
            document.getElementById('actions').style.display = 'block';
            infoDiv.style.background = "#fff3e0";
            infoDiv.style.color = "#e67e22";
            if (!hasAnyBid) {
                infoDiv.innerText = "ğŸ† èµ·æ¨™åƒ¹ç‚ºï¼š$" + currentStartPrice;
            } else {
                // æ‰¾å‡ºç›®å‰æœ€é«˜æ¨™
                const maxBid = Math.max(...Object.values(bidsList));
                infoDiv.innerText = "ğŸ”¥ ç›®å‰æœ€é«˜åƒ¹ï¼š$" + maxBid;
            }
        }
    });

    // å‡ºåƒ¹å‡½æ•¸
    function bid(amt) {
        const nameInput = document.getElementById('userName');
        const name = nameInput.value.trim();
        
        if (!name) {
            nameInput.style.borderColor = "red";
            showMsg("âš ï¸ è«‹è¼¸å…¥å§“åå¾Œå†å‡ºåƒ¹", "red");
            return;
        }
        nameInput.style.borderColor = "#ddd";

        // äº¤æ˜“è™•ç†ï¼šç¢ºä¿å¤šäººåŒæ™‚å‡ºåƒ¹ä¸æœƒç®—éŒ¯
        db.child('bids').child(name).transaction((curr) => {
            const hasAnyBid = Object.keys(bidsList).length > 0;
            if (!hasAnyBid) {
                // å¦‚æœæ˜¯ç¬¬ä¸€ä½å‡ºåƒ¹è€…ï¼šèµ·æ¨™åƒ¹ + å–Šåƒ¹
                return currentStartPrice + amt;
            } else {
                // å¦‚æœå·²æœ‰å‡ºåƒ¹ï¼šåŸåƒ¹ + å–Šåƒ¹
                return (curr || 0) + amt;
            }
        });
        showMsg("âœ… æˆåŠŸå‡ºåƒ¹ +$" + amt, "#27ae60");
    }

    // æ£„æ¨™å‡½æ•¸
    function quitBid() {
        const name = document.getElementById('userName').value.trim();
        if (!name) return alert("è«‹è¼¸å…¥æ‚¨çš„å§“å");
        if (confirm("ç¢ºå®šè¦æ£„æ¨™å—ï¼Ÿæ‚¨çš„å‡ºåƒ¹å°‡è¢«ç§»é™¤ã€‚")) {
            db.child('bids').child(name).remove();
            showMsg("å·²å–æ¶ˆæ‚¨çš„å‡ºåƒ¹", "#7f8c8d");
        }
    }

    // è¨Šæ¯é¡¯ç¤º
    function showMsg(t, color) {
        const m = document.getElementById('msg');
        m.innerText = t;
        m.style.color = color;
        setTimeout(() => { if(m.innerText === t) m.innerText = ""; }, 2000);
    }
</script>
</body>
</html>