<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我要出價</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 15px; text-align: center; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
        input { width: 100%; padding: 15px; font-size: 18px; border: 2px solid #ddd; border-radius: 10px; box-sizing: border-box; margin-bottom: 20px; text-align: center; }
        .b-call { width: 100%; padding: 20px; font-size: 24px; background: #3498db; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; margin-bottom: 15px; box-shadow: 0 4px #2980b9; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button.b-add { padding: 15px; font-size: 18px; border: none; border-radius: 10px; color: white; cursor: pointer; background: #27ae60; }
        .b-quit { background: #95a5a6; grid-column: span 2; margin-top: 10px; padding: 12px; color: white; border: none; border-radius: 10px; }
        #info { color: #e67e22; font-weight: bold; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="card">
    <div id="info">載入中...</div>
    <input type="text" id="userName" placeholder="請輸入您的姓名">
    
    <div id="actions">
        <button class="b-call" onclick="bid(1)">喊價 (+1)</button>
        <div class="grid">
            <button class="b-add" onclick="bid(5)">+$5</button>
            <button class="b-add" onclick="bid(10)">+$10</button>
            <button class="b-add" onclick="bid(50)">+$50</button>
            <button class="b-add" onclick="bid(100)">+$100</button>
            <button class="b-quit" onclick="quitBid()">❌ 我要棄標</button>
        </div>
    </div>
    <div id="msg" style="margin-top:10px; font-weight:bold;"></div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBLKKHyGT1MHJqMq8q8tjJTBNTaIc7EKBs",
        authDomain: "money0115.firebaseapp.com",
        databaseURL: "https://money0115-default-rtdb.firebaseio.com",
        projectId: "money0115",
        storageBucket: "money0115.firebasestorage.app",
        messagingSenderId: "486161681478",
        appId: "1:486161681478:web:ea1107c2c5c8ebe6a5ce47",
        measurementId: "G-WT1BGS47KH"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref('auction_live');

    let currentStartPrice = 0;
    let hasAnyBid = false;

    db.on('value', (snapshot) => {
        const data = snapshot.val() || {};
        currentStartPrice = data.startPrice || 0;
        const bids = data.bids || {};
        hasAnyBid = Object.keys(bids).length > 0;
        
        document.getElementById('info').innerText = hasAnyBid ? "競標進行中" : "起標價為: $" + currentStartPrice;

        if (data.status === 'closed') {
            document.getElementById('actions').style.display = 'none';
            document.getElementById('msg').innerText = "競標已結束";
        } else {
            document.getElementById('actions').style.display = 'block';
        }
    });

    function bid(amt) {
        const name = document.getElementById('userName').value.trim();
        if (!name) return alert("請輸入姓名");

        db.child('bids').child(name).transaction((curr) => {
            if (!hasAnyBid) {
                // 如果是第一個出價的人，直接從起標價開始
                return currentStartPrice + amt;
            } else {
                return (curr || 0) + amt;
            }
        });
    }

    function quitBid() {
        const name = document.getElementById('userName').value.trim();
        if (name && confirm("確定棄標？")) db.child('bids').child(name).remove();
    }
</script>
</body>
</html>