<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ç¾å ´å³æ™‚ç«¶æ¨™</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        body { font-family: 'Microsoft JhengHei', sans-serif; background: #1a1a1a; color: white; text-align: center; margin: 0; overflow: hidden; }
        .header { padding: 30px; background: #c0392b; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .price-tag { font-size: 100px; color: #f1c40f; margin: 10px 0; font-weight: bold; text-shadow: 0 0 30px rgba(241, 196, 15, 0.8); }
        .winner-announcement { display: none; font-size: 60px; color: #2ecc71; animation: celebrate 0.5s infinite alternate; }
        @keyframes celebrate { from { transform: scale(1); } to { transform: scale(1.1); } }
        
        .main-layout { display: flex; justify-content: space-around; padding: 40px; }
        #qrcode-container { background: white; padding: 20px; border-radius: 15px; width: 220px; }
        #leaderboard { width: 50%; background: rgba(255,255,255,0.05); border-radius: 20px; padding: 20px; }
        .bid-row { display: flex; justify-content: space-between; font-size: 32px; padding: 15px; border-bottom: 1px solid #333; }
        .rank-1 { background: #f1c40f; color: black; border-radius: 10px; font-weight: bold; }

        .admin-panel { position: fixed; bottom: 0; width: 100%; background: #333; padding: 15px; display: flex; justify-content: center; gap: 20px; }
        .admin-btn { padding: 10px 25px; font-size: 18px; border: none; border-radius: 5px; cursor: pointer; color: white; }
        .btn-new { background: #3498db; }
        .btn-end { background: #e74c3c; font-weight: bold; }
    </style>
</head>
<body>

<div class="header">
    <h1>ç¾å ´å³æ™‚ç«¶æ¨™</h1>
</div>

<div style="margin-top:20px;">
    <div id="statusText" style="font-size: 24px; color: #bdc3c7;">ç›®å‰æœ€é«˜æ¨™</div>
    <div class="price-tag" id="mainPrice">$0</div>
    <div id="mainUser" style="font-size: 40px;">ç­‰å¾…å‡ºåƒ¹ä¸­...</div>
    <div id="winnerMsg" class="winner-announcement">ğŸŠ æ­å–œå¾—æ¨™ï¼ ğŸŠ</div>
</div>

<div class="main-layout">
    <div id="qrcode-container">
        <div id="qrcode"></div>
        <p style="color: black; margin-top: 10px; font-weight: bold;">æƒç¢¼åƒèˆ‡ç«¶æ¨™</p>
    </div>
    <div id="leaderboard">
        <div id="list"></div>
    </div>
</div>

<div class="admin-panel">
    <button class="admin-btn btn-new" onclick="startNewAuction()">ğŸ”„ é–‹å•Ÿæ–°ç«¶æ¨™</button>
    <button class="admin-btn btn-end" onclick="finishAuction()">ğŸ”¨ æ±ºæ¨™ (æˆäº¤)</button>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBLKKHyGT1MHJqMq8q8tjJTBNTaIc7EKBs",
        authDomain: "money0115.firebaseapp.com",
        databaseURL: "https://money0115-default-rtdb.firebaseio.com",
        projectId: "money0115",
        storageBucket: "money0115.firebasestorage.app",
        messagingSenderId: "486161681478",
        appId: "1:486161681478:web:ea1107c2c5c8ebe6a5ce47",
        measurementId: "G-WT1BGS47KH"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref('auction_live');

    db.on('value', (snapshot) => {
        const data = snapshot.val() || {};
        const bids = data.bids || {};
        const status = data.status || 'open';
        const sorted = Object.entries(bids).sort((a, b) => b[1] - a[1]);

        if (status === 'closed') {
            document.getElementById('winnerMsg').style.display = 'block';
            document.getElementById('qrcode-container').style.opacity = '0.2';
        } else {
            document.getElementById('winnerMsg').style.display = 'none';
            document.getElementById('qrcode-container').style.opacity = '1';
        }

        if (sorted.length > 0) {
            document.getElementById('mainPrice').innerText = "$" + sorted[0][1];
            document.getElementById('mainUser').innerText = sorted[0][0];
        } else {
            document.getElementById('mainPrice').innerText = "$0";
            document.getElementById('mainUser').innerText = "ç­‰å¾…å‡ºåƒ¹ä¸­...";
        }

        const listDiv = document.getElementById('list');
        listDiv.innerHTML = sorted.slice(0, 5).map((item, index) => `
            <div class="bid-row ${index === 0 ? 'rank-1' : ''}">
                <span>${index + 1}. ${item[0]}</span>
                <span>$${item[1]}</span>
            </div>
        `).join('');
    });

    // é—œéµä¿®æ”¹ï¼šè‡ªå‹•åµæ¸¬ GitHub Pages ç¶²å€ä¸¦å°å‘åŒç›®éŒ„ä¸‹çš„ bid.html
    const currentUrl = window.location.href.split('?')[0].split('#')[0];
    const phoneUrl = currentUrl.substring(0, currentUrl.lastIndexOf('/')) + "/bid.html";
    
    new QRCode(document.getElementById("qrcode"), { 
        text: phoneUrl, 
        width: 200, 
        height: 200,
        correctLevel : QRCode.CorrectLevel.H
    });

    function startNewAuction() {
        if(confirm("ç¢ºå®šè¦é‡å•Ÿç«¶æ¨™å—ï¼Ÿ")) db.set({ status: 'open', bids: {} });
    }
    function finishAuction() {
        if(confirm("ç¢ºå®šè¦æ±ºæ¨™å—ï¼Ÿ")) db.child('status').set('closed');
    }
</script>
</body>
</html>